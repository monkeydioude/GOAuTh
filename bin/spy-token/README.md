# spy-token

Development utility that generates a JWT token for a given user. Useful for debugging, testing authenticated endpoints, or manually crafting tokens with a specific expiration date.

## Build

```bash
go build -C bin/spy-token -o spy-token
```

## Usage

```bash
./spy-token <expiration-date> <email> <realm>
```

### Arguments

| Position | Name              | Format       | Description                                   |
|----------|-------------------|--------------|-----------------------------------------------|
| 1        | expiration-date   | `YYYY-MM-DD` | Token expiration (and refresh) date           |
| 2        | email             | string       | User login (email) to look up in the database |
| 3        | realm             | string       | Realm name the user belongs to                |

The tool looks up the user in the database by login + realm, then generates a JWT signed with `JWT_SECRET` and prints it to stdout.

## Configuration

Loaded from environment variables or a `.env` file.

| Variable     | Description                        |
|--------------|------------------------------------|
| `DB_PATH`    | PostgreSQL connection string       |
| `DB_SCHEMA`  | Database schema (default `public`) |
| `JWT_SECRET` | JWT HS256 signing secret           |

## Example

```bash
# Generate a token expiring on 2026-12-31 for user@example.com in the "default" realm
./spy-token 2026-12-31 user@example.com default
```

Output:

```
eyJhbGciOiJIUzI1NiIs...
```

## Notes

- The generated token uses the same signing method (`HS256`) and claims structure as GOAuTh itself.
- Both `Expire` and `Refresh` claims are set to the same provided date.
- The revocation checker is a no-op â€” tokens generated by this tool are never considered revoked.
- This tool is intended for **development and debugging only**. Do not use it in production workflows.
